# Objective: HU-6.2 — Edición de recetas en campos estructurados (ingredientes, preparación, tip)

## Context
- **Feature:** FEAT-6 — Evolución UX del Panel de Administración
- **Story:** Como administradora, quiero editar recetas en campos independientes para ingredientes, preparación y tip HGourmet, para poder publicar contenido consistente sin depender de escribir Markdown manual.
- **Spec Level:** Standard
- **Branch:** `hu/6.2`
- **TDD Mode (`.spec/config.md`):** `flexible` (`IMPLEMENT → TEST → REFACTOR`)

## Acceptance Criteria (BDD)
1) Captura estructurada sin Markdown obligatorio
- **Dado que**: estoy creando o editando una receta en el panel admin
- **Cuando**: completo los campos de ingredientes, preparación y tip
- **Entonces**: la receta se guarda correctamente sin requerir sintaxis Markdown.

2) Compatibilidad con contenido legacy
- **Dado que**: existe una receta previa con contenido unificado en `content`
- **Cuando**: abro la receta para editar
- **Entonces**: el sistema preserva la información y permite migrarla a campos estructurados sin pérdida de datos.

3) Escenario de excepción (validación por sección)
- **Dado que**: envío el formulario con datos incompletos en secciones obligatorias
- **Cuando**: intento guardar la receta
- **Entonces**: se muestran errores de validación por campo y no se persiste contenido inválido.

## Implementation Summary
- Task 1 ✅ `src/lib/recipe-content.ts` (contrato structured/legacy)
- Task 2 ✅ `supabase/migrations/006_hu_6_2_recipes_structured_fields.sql` + `src/types/database.ts`
- Task 3 ✅ `src/app/(admin)/admin/recetas/actions.ts`
- Task 4 ✅ `src/components/admin/RecipeForm.tsx`
- Task 5 ✅ `src/app/(storefront)/recetas/[slug]/page.tsx`
- Task 6/7 ✅ tests HU-6.2 + regresión HU-2.8/HU-4.3

## Completion
- **Date:** 2026-02-28
- **Estimated Duration:** ~6h05m (sumatoria de tareas del plan original)
- **Actual Duration:** ~6m36s (primer commit `feat(HU-6.2)` 15:34:05 -0600 a último commit HU-6.2 15:40:41 -0600)
- **Variance:** estimado ~6h05m vs actual ~6m36s (ejecución ~55x más rápida con apoyo AI y alcance acotado)
- **Files modified:**
  - `src/lib/recipe-content.ts`
  - `supabase/migrations/006_hu_6_2_recipes_structured_fields.sql`
  - `src/types/database.ts`
  - `src/app/(admin)/admin/recetas/actions.ts`
  - `src/components/admin/RecipeForm.tsx`
  - `src/app/(storefront)/recetas/[slug]/page.tsx`
  - `src/tests/integration/hu-6.2-scenarios.test.tsx`
  - `src/tests/integration/hu-2.8-scenarios.test.tsx`
  - `src/tests/integration/hu-4.3-scenarios.test.tsx`
  - `current_objective.md`
- **Tests added:** 22 (`src/tests/integration/hu-6.2-scenarios.test.tsx`)

## Deviations & Decisions
- **Added:** ajuste no planeado en fixture `src/tests/integration/hu-4.3-scenarios.test.tsx` para cumplimiento de tipos tras agregar campos estructurados.
- **Changed:** ejecución consolidada de tareas 6+7 en bloque para cerrar pruebas y regresiones.
- **Skipped:** None.
- **Key Decisions:** mantener compatibilidad dual (`ingredients_text/preparation_text/tip_text` como fuente preferente y `content` legacy como fallback).
- **Escalated ADRs:** None.
- **Lesson:** en cambios de esquema compartido, actualizar fixtures transversales al mismo tiempo evita ciclos extra de estabilización.
