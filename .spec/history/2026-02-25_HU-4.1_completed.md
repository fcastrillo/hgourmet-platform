# Objective: HU-4.1 — Pagina principal con banners rotativos y secciones destacadas

## Context
- **Feature:** FEAT-4 — Contenido y Marketing Digital
- **Story:** Como visitante del sitio, quiero ver una homepage clara, atractiva y bien estructurada, para poder ubicar rapidamente productos, categorias y propuestas de valor de HGourmet.
- **Spec Level:** Lite
- **Git Strategy:** trunk (work continues on `main`)
- **TDD Mode:** flexible (`IMPLEMENT → TEST → REFACTOR`)

## Validation Gate (Step 0 - @validate)

### Validation Report
=== VALIDATION REPORT ===
Target: HU-4.1 — Pagina principal con banners rotativos y secciones destacadas
Level: Standard (Simple Story)

✅ PRD: Vision, users, MVP IN/OUT and KPIs are complete.
✅ TECH_SPEC: Stack, Data Model, Authentication and RLS are complete.
✅ FEAT-4: Benefit hypothesis and HU linkage are complete.
✅ HU-4.1: C/Q/P format + 3 BDD scenarios including error path are present.
⚠️ HU-4.1: "Paridad visual" language is partially subjective; convert to observable checks in implementation tests/checklist.

RESULT: WARNINGS
ACTION: Proceed to planning and implementation. No BLOCKER found.

## Acceptance Criteria (BDD)

### Escenario 1: Homepage estable en multiples dispositivos
- **Dado que** ingreso a la homepage desde movil o desktop,
- **Cuando** carga la pagina,
- **Entonces** visualizo hero, banners activos y secciones destacadas sin errores de layout.

### Escenario 2: Render de banners segun estado y orden
- **Dado que** existen banners administrados en panel,
- **Cuando** se renderiza el carrusel,
- **Entonces** solo se muestran los banners activos y en el orden configurado.

### Escenario 3: Cierre de brecha visual de confianza (error UX)
- **Dado que** un visitante no encuentra senales claras de confianza,
- **Cuando** se evalua la paridad visual final contra Lovable,
- **Entonces** se incorporan o ajustan bloques de valor para cerrar la brecha respecto al diseno objetivo.

## Implementation Plan

### Task 1: Baseline visual + component map for homepage ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** All storefront components reviewed

### Task 2: Unify Hero + active banners into one carousel surface ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `BannerCarousel.tsx`, `page.tsx`, `homepage.test.tsx`
- **Commit:** `57b2628`

### Task 3: Restore heading hierarchy and mixed-accent typography parity ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `BrandSection.tsx` (accent span added to "Marcas")

### Task 4: Add trust-value block "Por que elegirnos" on homepage ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `WhyChooseSection.tsx` (new), `page.tsx`

### Task 5: Remove white-card artifact on category images ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `CategoryImage.tsx` (mix-blend-mode: multiply)

### Task 6: Validate responsive visual consistency (desktop + mobile smoke) ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Tests:** 403/403 passing (all repo)

### Task 7: Final quality gate and build integrity ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Result:** 0 TypeScript errors, 0 lint errors, 403/403 tests passing

## Database Changes
- No database changes required.
- No RLS or migration updates required.

## Infrastructure Prerequisites
- None. This objective does not require new buckets, env vars, or external services.

## Manual Testing Checklist
- [x] Open `/` on desktop and verify a single hero/carrusel region is rendered above categories.
- [x] With active banners in admin, verify hero appears as first slide and banners follow configured order.
- [x] With no active banners, verify homepage shows only hero (no duplicate banner section below).
- [x] Verify section title styling parity against target prototype (accent word + hierarchy) for:
  - [x] "Nuestras Categorias"
  - [x] "Lo mas vendido"
  - [x] "Productos de temporada"
  - [x] "Nuestras marcas"
  - [x] "Por que elegirnos?"
- [x] Verify category images do not show white rectangular artifact and blend correctly with card background.
- [x] Verify "Por que elegirnos?" shows 3 trust cards with icon + title + descriptive copy.
- [x] Smoke test mobile breakpoints (375px and 768px) for layout integrity (no overlap, clipping, or overflow).

## Definition of Done
- [x] All BDD criteria have passing tests.
- [x] No TypeScript errors.
- [x] No RLS changes required (N/A confirmed).
- [x] CHANGELOG entry drafted.
- [x] All changes committed with `feat(HU-4.1):` convention.
- [x] Tag `HU-4.1` created.

## Completion
- **Date:** 2026-02-25
- **Estimated Duration:** XS (~4-8h, referencia en `docs/BACKLOG.md`)
- **Actual Duration:** ~9 minutos (11:11 → 11:20, commits HU-4.1)
- **Variance:** Muy por debajo de la estimación (aceleración por reutilización de componentes existentes y ajuste incremental guiado por validación visual).
- **Files modified:** `src/app/(storefront)/page.tsx`, `src/components/storefront/BannerCarousel.tsx`, `src/components/storefront/BrandSection.tsx`, `src/components/storefront/CategoryImage.tsx`, `src/components/storefront/CategoryShowcase.tsx`, `src/components/storefront/ProductSection.tsx`, `src/components/storefront/WhyChooseSection.tsx`, `src/tests/integration/homepage.test.tsx`, `current_objective.md`
- **Tests added:** +5 netos en `homepage.test.tsx` (suite final: 10 tests)

## Deviations & Decisions
- **Added:** Ajuste de contraste/acento tipográfico (`text-accent`) y centrado de títulos de secciones de productos para igualar Lovable tras feedback de validación final.
- **Changed:** El carrusel quedó unificado como una sola superficie (Hero como slide 0 + banners activos), sustituyendo el patrón previo de Hero + bloque de banners separado.
- **Skipped:** Ninguno.
- **Key Decisions:** Aplicar `mix-blend-mode: multiply` en imágenes de categoría para mitigar fondos blancos sin reprocesar assets.
- **Escalated ADRs:** None (desviaciones clasificadas como tácticas).
- **Lesson:** En historias de cierre visual, conviene planear una mini-ronda explícita de ajuste post-validación para capturar diferencias finas de contraste y alineación.
