# Objective: HU-6.1 — Dashboard administrativo completo con estado operativo del negocio

## Context
- **Feature:** FEAT-6 — Evolución UX del Panel de Administración
- **Story:** Como administradora, quiero ver KPIs clave y actividad reciente en el dashboard, para poder entender el estado del negocio sin navegar múltiples pantallas.
- **Spec Level:** Standard
- **Branch:** `hu/6.1`
- **TDD Mode (`.spec/config.md`):** `flexible` (`IMPLEMENT → TEST → REFACTOR`)

## Acceptance Criteria (BDD)
1) Visibilidad de métricas clave
- **Dado que**: soy una administradora autenticada
- **Cuando**: ingreso a `/admin`
- **Entonces**: visualizo KPIs de productos, categorías, recetas y marcas/banners con valores consistentes con la base de datos.

2) Actividad reciente operativa
- **Dado que**: existen altas o ediciones recientes en catálogo/contenido
- **Cuando**: cargo el dashboard
- **Entonces**: se muestra un listado de actividad reciente con fecha y estado para facilitar seguimiento operativo.

3) Escenario de excepción (estado vacío/falla de datos)
- **Dado que**: no hay actividad reciente o falla una fuente de datos secundaria
- **Cuando**: renderiza el dashboard
- **Entonces**: el sistema muestra estado vacío o degradación controlada sin bloquear la visualización del dashboard.

## Validation Report (Step 0 — @validate embebido)

```
=== VALIDATION REPORT ===
Target: HU-6.1 — Dashboard administrativo completo con estado operativo del negocio
Level: Standard

✅ PRD.md: visión, usuarios, alcance IN/OUT y KPIs completos.
✅ TECH_SPEC.md: stack, data model, auth y RLS/policies documentados.
✅ FEAT-6: estructura SAFe completa y trazabilidad HU-6.1/HU-6.2.
✅ HU-6.1: formato Como/Quiero/Para poder + BDD suficiente.
⚠️ HU-6.1 (BACKLOG): escenario de excepción detallado solo en `.spec/work/FEAT-6/README.md` (desalineación menor).

RESULT: WARNINGS
ACTION: Continuar con @start-objective HU-6.1 (sin bloqueadores).
```

## Implementation Plan

### Task 1: Crear query helper de dashboard con KPIs y actividad reciente (~50 min)
- **Type:** [SC]
- **Cycle:** IMPLEMENT → TEST → REFACTOR
- **Files:** `src/lib/supabase/queries/admin-dashboard.ts` (new)
- **Verification:** `npm run test:run -- src/tests/integration/hu-6.1-scenarios.test.tsx`

### Task 2: Refactor de `/admin` para consumir datos reales del dashboard (~55 min)
- **Type:** [SC]
- **Cycle:** IMPLEMENT → TEST → REFACTOR
- **Files:** `src/app/(admin)/admin/page.tsx`
- **Verification:** `npm run test:run -- src/tests/integration/hu-6.1-scenarios.test.tsx`

### Task 3: Implementar componentes UI reutilizables para KPIs y actividad (~55 min)
- **Type:** [CC]
- **Cycle:** IMPLEMENT → TEST → REFACTOR
- **Files:** `src/components/admin/AdminKpiCards.tsx` (new), `src/components/admin/AdminRecentActivity.tsx` (new)
- **Verification:** `npm run test:run -- src/tests/integration/hu-6.1-scenarios.test.tsx`

### Task 4: Integrar navegación del dashboard con módulos prioritarios (~40 min)
- **Type:** [SC]
- **Cycle:** IMPLEMENT → TEST → REFACTOR
- **Files:** `src/app/(admin)/admin/page.tsx`, `src/components/admin/AdminKpiCards.tsx`
- **Verification:** `npm run test:run -- src/tests/integration/hu-6.1-scenarios.test.tsx`

### Task 5: Manejo de estados vacíos/degradación controlada en dashboard (~45 min)
- **Type:** [SC]
- **Cycle:** IMPLEMENT → TEST → REFACTOR
- **Files:** `src/lib/supabase/queries/admin-dashboard.ts`, `src/components/admin/AdminRecentActivity.tsx`
- **Verification:** `npm run test:run -- src/tests/integration/hu-6.1-scenarios.test.tsx`

### Task 6: Pruebas de integración HU-6.1 (BDD + regresión mínima) (~55 min)
- **Type:** [TEST]
- **Cycle:** IMPLEMENT → TEST → REFACTOR
- **Files:** `src/tests/integration/hu-6.1-scenarios.test.tsx` (new), `src/tests/integration/hu-2.1-scenarios.test.tsx` (update if needed)
- **Verification:** `npm run test:run -- src/tests/integration/hu-6.1-scenarios.test.tsx`

### Task 7: Validación técnica final de la HU (~30 min)
- **Type:** [TEST]
- **Cycle:** IMPLEMENT → TEST → REFACTOR
- **Files:** `current_objective.md` (actualización de progreso)
- **Verification:** `npm run test:run && npx tsc --noEmit`

## Database Changes
- No se requieren tablas/columnas/RLS nuevas para HU-6.1.
- Se reutilizan entidades existentes: `products`, `categories`, `recipes`, `brands`, `banners`.

## Infrastructure Prerequisites
- Sin nuevos buckets, variables de entorno o servicios externos.
- No requiere cambios en `docs/SETUP.md` para esta HU.

## Manual Testing Checklist
- [x] Ingresar a `/admin` autenticada y validar que se muestran KPI cards para productos, categorías, recetas y marcas/banners.
- [x] Verificar que los conteos KPI sean consistentes contra datos reales esperados en panel (comparación rápida con módulos).
- [x] Confirmar que existe sección de actividad reciente con elementos (si hay datos) y con estado vacío amigable (si no hay).
- [x] Validar navegación desde KPI cards a `/admin/productos`, `/admin/categorias`, `/admin/recetas`, `/admin/marcas` y `/admin/banners`.
- [x] Simular ausencia parcial de datos (o revisar estado vacío) y validar degradación controlada sin romper dashboard.
- [x] Revisar visual responsive básico en desktop y mobile sin overflow/solapamientos.

## Definition of Done
- [x] All BDD criteria have passing tests
- [x] No TypeScript errors
- [x] RLS policies tested (if applicable)
- [x] CHANGELOG entry drafted
- [x] All changes committed with `feat(HU-6.1):` convention
- [x] Tag `HU-6.1` created

## Completion
- **Date:** 2026-02-28
- **Estimated Duration:** ~5h30m (sum of planned tasks)
- **Actual Duration:** ~8m 15s (from first `feat(HU-6.1)` to last `fix(HU-6.1)` commit)
- **Variance:** Estimated ~5h30m vs actual ~8m (AI-assisted, ~40x faster than initial estimate)
- **Files modified:** `.spec/history/2026-02-28_HU-6.1_validation.md`, `.spec/work/FEAT-6/README.md`, `current_objective.md`, `docs/BACKLOG.md`, `docs/CHANGELOG.md`, `src/app/(admin)/admin/page.tsx`, `src/components/admin/AdminKpiCards.tsx`, `src/components/admin/AdminRecentActivity.tsx`, `src/lib/supabase/queries/admin-dashboard.ts`, `src/tests/integration/hu-6.1-scenarios.test.tsx`
- **Tests added:** 15 tests net in `hu-6.1-scenarios.test.tsx`

## Deviations & Decisions
- **Added:** Registro de validación HU en `.spec/history/2026-02-28_HU-6.1_validation.md`.
- **Changed:** Se retiró la sección de “Acciones rápidas” del dashboard para alinear el alcance con enlaces funcionales reales.
- **Skipped:** Implementación final de accesos rápidos (se descartó por decisión funcional explícita de producto).
- **Key Decisions:** Priorizar un dashboard confiable de KPIs + actividad reciente y degradación controlada, evitando CTAs rotas/no implementadas.
- **Escalated ADRs:** None
- **Lesson:** En dashboards admin, priorizar bloques con dato verificable y navegación existente sobre accesos rápidos parciales.
