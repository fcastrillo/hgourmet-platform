# Objective: HU-3.1 — Boton fijo de WhatsApp en todo el sitio

## Context
- **Feature:** FEAT-3 — Canal de Comunicacion y Conversion WhatsApp
- **Story:** Como cliente navegando el sitio, quiero ver un boton flotante de WhatsApp siempre visible, para poder contactar a HGourmet desde cualquier pagina con un solo clic.
- **Spec Level:** Lite
- **Git Mode:** trunk (sin rama `hu/N.M`; trabajo sobre `main`)
- **TDD Mode:** flexible (`IMPLEMENT → TEST → REFACTOR`)

## Acceptance Criteria (BDD)
1. El boton flotante es visible en todas las rutas publicas del storefront y no tapa CTAs primarios.
2. Al hacer clic, abre un deep link `wa.me` valido usando el numero definido en `SOCIAL_LINKS.whatsapp`.
3. La implementacion mantiene paridad visual con el prototipo Lovable (forma, tamano, jerarquia, espaciado, hover/active).
4. Si el enlace de WhatsApp esta ausente o invalido, la UI no se rompe y se muestra fallback seguro.

## Implementation Plan (Executed)

### Task 1+3: Crear componente flotante reutilizable con fallback (~35 min) ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `src/components/storefront/WhatsAppFloatingButton.tsx` (new)
- **Commit:** 2c32b06

### Task 2: Integrar el boton en layout global del storefront (~20 min) ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `src/app/(storefront)/layout.tsx`
- **Commit:** 2c32b06

### Task 4: Cubrir criterios BDD con pruebas de integración (~40 min) ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `src/tests/integration/whatsapp-floating-button.test.tsx` (new, 9 tests), `src/tests/integration/storefront-layout.test.tsx` (2 tests added)
- **Result:** 17/17 tests del objetivo passing, 268/268 total suite
- **Commit:** 2c32b06

### Task 5: Validacion final de calidad y regresion completa (~30 min) ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **TS check:** sin errores en archivos HU-3.1
- **Test suite:** 22 test files, 268 tests, 0 regresiones
- **Commit:** 2c32b06

## Manual Testing Checklist
- [x] Abrir `/` en desktop y mobile; confirmar boton flotante en esquina inferior derecha sin tapar CTAs primarios.
- [x] Navegar a `/categorias`, `/productos/[slug]`, `/recetas`, `/contacto`; confirmar presencia consistente del boton.
- [x] Hacer clic en el boton con configuracion valida; verificar apertura de URL `https://wa.me/...`.
- [x] Simular enlace invalido/vacio en `SOCIAL_LINKS.whatsapp`; verificar que la UI no rompe y muestra fallback seguro.
- [x] Verificar estados visuales hover/active y jerarquia visual respecto al prototipo Lovable.
- [x] Ejecutar `npm run test:run` sin errores.

## Definition of Done
- [x] Todos los criterios BDD de HU-3.1 estan cubiertos por pruebas y pasan localmente (268/268).
- [x] No hay errores de TypeScript ni de lint en archivos HU-3.1.
- [x] No aplica validacion de RLS para esta historia (sin cambios de datos).
- [x] Entrada de CHANGELOG agregada.
- [x] Commits siguiendo convención `feat(HU-3.1): ...` (commit 2c32b06).
- [x] Tag `HU-3.1` creado al cierre de objetivo.

## Completion
- **Date:** 2026-02-23
- **Estimated Duration:** ~150 min (35 + 20 + 25 + 40 + 30)
- **Actual Duration:** ~0 min (solo 1 commit `feat(HU-3.1)` con timestamp único en git)
- **Variance:** Menor al estimado; evidencia de alta aceleración por implementación asistida.
- **Files modified:** `src/components/storefront/WhatsAppFloatingButton.tsx`, `src/app/(storefront)/layout.tsx`, `src/tests/integration/whatsapp-floating-button.test.tsx`, `src/tests/integration/storefront-layout.test.tsx`
- **Tests added:** 11

## Deviations & Decisions
- **Added:** Seguridad de enlace externo (`rel="noopener noreferrer"`), prop opcional `whatsappUrl` para testabilidad.
- **Changed:** El fallback inválido se implementó como no-render (`return null`) en lugar de botón deshabilitado/mensaje explícito.
- **Skipped:** Ninguna tarea del plan.
- **Key Decisions:** Reuso de lineamientos existentes ADR-006 (brand colors inline) y ADR-011 (SVG con `width/height` nativo).
- **Escalated ADRs:** None
- **Lesson:** Para criterios de fallback UX, conviene fijar un comportamiento único (disabled vs hidden) desde el plan para evitar ambigüedad.
