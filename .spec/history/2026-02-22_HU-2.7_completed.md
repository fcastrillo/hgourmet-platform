# Objective: HU-2.7 — Icon buttons y toggle inline en CategoryTable

## Context
- **Feature:** FEAT-2 — Panel de Administración
- **Story:** Como administradora de HGourmet, quiero ver acciones compactas con iconos y poder activar/desactivar categorías inline, para poder gestionar categorías de forma más ágil sin abrir modales innecesarios
- **Spec Level:** Lite
- **Note:** Esta HU establece el nuevo estándar de UI para las pantallas de administración subsecuentes (HU-2.5, HU-2.6, etc.). Los patrones aquí definidos (icon buttons con tooltip, toggle inline, aria-labels) deben replicarse en futuras tablas de administración.

## Acceptance Criteria (BDD)

### Escenario 1: Icon buttons en tabla desktop
> **Dado que** estoy en la tabla de categorías desktop,
> **Cuando** veo la columna "Acciones",
> **Entonces** veo tres icon buttons (pencil, eye/eye-slash, trash) con tooltip nativo en lugar de botones de texto.

### Escenario 2: Toggle desactivar categoría activa
> **Dado que** una categoría está activa (is_active=true),
> **Cuando** hago clic en el icono de ojo,
> **Entonces** la categoría se desactiva (is_active=false) y el icono cambia a eye-slash sin recargar la página.

### Escenario 3: Toggle activar categoría inactiva
> **Dado que** una categoría está inactiva (is_active=false),
> **Cuando** hago clic en el icono de ojo-tachado,
> **Entonces** la categoría se activa (is_active=true) y el icono cambia a eye sin recargar la página.

### Escenario 4: Acciones en vista mobile
> **Dado que** estoy en la vista mobile,
> **Cuando** veo las cards de categorías,
> **Entonces** las acciones mantienen formato táctil adecuado (con label o iconos con label).

### Escenario 5: Tests de integración compatibles
> **Dado que** los tests de integración buscan botones por aria-label,
> **Cuando** ejecuto la suite de tests,
> **Entonces** todos los tests pasan usando aria-label="Editar", aria-label="Activar"/"Desactivar", aria-label="Eliminar".

## Implementation Plan

### Task 1: Crear server action `toggleCategoryActive` ✅
- **Type:** [SA]
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `src/app/(admin)/admin/categorias/actions.ts`

### Task 2: Modificar CategoryTable — Icon buttons + toggle inline ✅
- **Type:** [CC]
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `src/components/admin/CategoryTable.tsx`

### Task 3: Actualizar tests de integración ✅
- **Type:** [TEST]
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `src/tests/integration/hu-2.4-scenarios.test.tsx`

## Completion
- **Date:** 2026-02-22
- **Estimated Duration:** XS (~50 min planned: 10 + 25 + 15)
- **Actual Duration:** ~10 min (14:08 → 14:19, single feat commit)
- **Variance:** Estimated XS (~50 min), actual ~10 min — ~5x faster with AI assistance
- **Files modified:**
  - `src/app/(admin)/admin/categorias/actions.ts` (+20 lines)
  - `src/components/admin/CategoryTable.tsx` (+389/-123 lines, full rewrite)
  - `src/tests/integration/hu-2.4-scenarios.test.tsx` (+165 lines)
  - `current_objective.md`
- **Tests added:** 12 new tests (total 32 in suite, 30 existing + 12 new HU-2.7 - 10 unchanged)

## Deviations & Decisions
- **Added:** None
- **Changed:** None
- **Skipped:** None
- **Key Decisions:** Used `activeOverrides` Record + `useTransition` for optimistic toggle state instead of React 19 `useOptimistic` — consistent with existing `useTransition` pattern for reorder.
- **Escalated ADRs:** ADR-009 — Admin Table UI Standard (icon buttons, inline toggle, aria-labels, optimistic updates)
- **Lesson:** Optimistic UI with deferred promises in tests: when testing optimistic updates, mock server actions must return unresolved promises to prevent the override from being cleared before assertion.
