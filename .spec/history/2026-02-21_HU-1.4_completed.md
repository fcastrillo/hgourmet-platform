# Objective: HU-1.4 — Sección "Lo más vendido" y "Productos de temporada"

## Context
- **Feature:** FEAT-1 — Catálogo Digital de Productos
- **Story:** Como cliente de HGourmet, quiero ver secciones destacadas con los productos más vendidos y los productos de temporada, para poder descubrir rápidamente los productos populares y las novedades estacionales sin buscar manualmente
- **Spec Level:** Lite
- **Git Strategy:** trunk (commits directos a main)
- **TDD Mode:** flexible (IMPLEMENT → TEST → REFACTOR)

## Acceptance Criteria (BDD)

### Scenario 1: Sección "Lo más vendido" con productos
- **Dado que:** Existen 10 productos con `is_featured = true` e `is_visible = true`
- **Cuando:** El cliente accede a la página principal
- **Entonces:** Se muestra la sección "Lo más vendido" con los primeros 8 productos destacados, cada uno con imagen, nombre, precio y badge de disponibilidad

### Scenario 2: Sección "Productos de temporada" con productos
- **Dado que:** Existen 5 productos con `is_seasonal = true` e `is_visible = true`
- **Cuando:** El cliente accede a la página principal
- **Entonces:** Se muestra la sección "Productos de temporada" con los 5 productos estacionales visibles en formato de tarjeta

### Scenario 3: Sección sin productos no se renderiza
- **Dado que:** No existen productos con `is_seasonal = true` e `is_visible = true`
- **Cuando:** El cliente accede a la página principal
- **Entonces:** La sección "Productos de temporada" no aparece en la página (ni título, ni contenedor vacío), y el resto del layout no se ve afectado

### Scenario 4: Enlace "Ver todos" navega a vista filtrada
- **Dado que:** La sección "Lo más vendido" muestra 8 de 12 productos destacados
- **Cuando:** El cliente hace clic en "Ver todos" de la sección "Lo más vendido"
- **Entonces:** Se navega a una vista que muestra los 12 productos destacados con el mismo formato de tarjeta

### Scenario 5: Producto destacado oculto no aparece (Error/Excepción)
- **Dado que:** Un producto tiene `is_featured = true` pero `is_visible = false`
- **Cuando:** El cliente accede a la página principal
- **Entonces:** Ese producto NO aparece en la sección "Lo más vendido", respetando el filtro de visibilidad sobre el flag de destacado

## Implementation Plan

### Task 1: Server-side query helpers ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `src/lib/supabase/queries/products.ts`
- **Commit:** 09dc469

### Task 2: ProductSection generic component ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `src/components/storefront/ProductSection.tsx`
- **Commit:** 09dc469

### Task 3: Homepage integration ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `src/app/(storefront)/page.tsx`
- **Commit:** 09dc469

### Task 4: "Ver todos" pages ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `src/app/(storefront)/productos/destacados/page.tsx`, `src/app/(storefront)/productos/temporada/page.tsx`
- **Commit:** 09dc469

### Task 5: Integration tests for BDD scenarios ✅
- **Cycle:** IMPLEMENT ✅ → TEST ✅ → REFACTOR ✅
- **Files modified:** `src/tests/integration/hu-1.4-scenarios.test.tsx`
- **Tests:** 10/10 pass (93/93 total, 0 regressions)
- **Commit:** 09dc469

### Task 6: Manual testing & seed validation ✅
- **Type:** [MANUAL]
- **Status:** All checks passed via browser verification
- **Verified:** Homepage sections, "Ver todos" pages, breadcrumbs, SEO metadata, availability badges

## Completion
- **Date:** 2026-02-21
- **Estimated Duration:** S (~3–6 horas)
- **Actual Duration:** ~30 minutes (single session with AI assistance)
- **Variance:** Estimated S (~3–6 hours), actual ~30 min — ~8x faster with AI assistance
- **Files modified:**
  - `src/lib/supabase/queries/products.ts` (4 queries added)
  - `src/components/storefront/ProductSection.tsx` (new)
  - `src/app/(storefront)/page.tsx` (integrated sections)
  - `src/app/(storefront)/productos/destacados/page.tsx` (new)
  - `src/app/(storefront)/productos/temporada/page.tsx` (new)
  - `src/tests/integration/hu-1.4-scenarios.test.tsx` (new)
- **Tests added:** 10 (total acumulado: 93)

## Deviations & Decisions
- **Added:** None
- **Changed:** None
- **Skipped:** None
- **Key Decisions:** None — all infrastructure (DB fields, indices, types, ProductCard, constants) was already in place from HU-1.1
- **Escalated ADRs:** None
- **Lesson:** When preceding stories lay solid infrastructure (typed queries, reusable components, constants), subsequent stories execute significantly faster with zero friction.
