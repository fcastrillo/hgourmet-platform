# Objective: HU-1.1 — Navegación por categorías de productos

## Context

- **Feature:** FEAT-1 — Catálogo Digital de Productos
- **Story:** Como cliente de HGourmet (repostero, estudiante o ama de casa), quiero navegar por las categorías de productos (Chocolate, Harinas, Sprinkles, Moldes, Materia Prima, Accesorios), para poder encontrar rápidamente los insumos que necesito sin recorrer todo el catálogo
- **Spec Level:** Standard
- **Git Strategy:** trunk (all commits to `main`)
- **Estimate:** M (~2–3 days)

## Acceptance Criteria (BDD)

### Scenario 1: Navegación exitosa por categoría

- **Dado que:** Existen 3 categorías activas ("Chocolate", "Harinas", "Moldes") con productos visibles
- **Cuando:** El cliente accede a la página de catálogo
- **Entonces:** Se muestran las 3 categorías ordenadas por `display_order`, cada una con su nombre y la cantidad de productos disponibles

### Scenario 2: Filtrado de productos al seleccionar categoría

- **Dado que:** La categoría "Chocolate" tiene 5 productos visibles y 2 ocultos
- **Cuando:** El cliente selecciona la categoría "Chocolate"
- **Entonces:** Se muestran únicamente los 5 productos visibles en formato de tarjeta con imagen, nombre, precio y disponibilidad

### Scenario 3: Producto agotado visible con indicador

- **Dado que:** El producto "Chocolate Belga 1kg" tiene `is_available = false` e `is_visible = true`
- **Cuando:** El cliente navega a la categoría que contiene ese producto
- **Entonces:** El producto se muestra con un badge visual "Agotado" y el botón de acción (WhatsApp) está deshabilitado o ausente

### Scenario 4: Categoría sin productos

- **Dado que:** La categoría "Sprinkles" está activa pero no tiene productos visibles
- **Cuando:** El cliente selecciona la categoría "Sprinkles"
- **Entonces:** Se muestra un mensaje amigable "No hay productos disponibles en esta categoría por el momento" en lugar de una página vacía

### Scenario 5: Categoría inactiva no visible (Error/Excepción)

- **Dado que:** La categoría "Temporada Navideña" tiene `is_active = false`
- **Cuando:** El cliente accede a la página de catálogo o intenta navegar directamente a `/categorias/temporada-navidena`
- **Entonces:** La categoría no aparece en el menú de navegación, y el acceso directo por URL retorna una página 404

## Implementation Plan

### Task 1: Project Scaffolding (~30 min) ✅
- **Commit:** `8aa952b`

### Task 2: Supabase Client Setup (~30 min) ✅
- **Commit:** `402bc30`

### Task 3: Database Schema — Categories + Products (~45 min) ✅
- **Commit:** `c8fb518`

### Task 4: Storefront Layout + Category Navigation (~45 min) ✅
- **Commit:** `8f28edc`

### Task 5: ProductCard Component (~30 min) ✅
- **Commit:** `d702a57`

### Task 6: Category Listing Page — `/categorias` (~45 min) ✅
- **Commit:** `446e826`

### Task 7: Category Detail Page — `/categorias/[slug]` (~45 min) ✅
- **Commit:** `5e763e6`

### Task 8: 404 Handling for Invalid Categories (~20 min) ✅
- **Commit:** `a863ab0`

### Task 9: Homepage Redirect + Polish (~20 min) ✅
- **Commit:** `51fda1c`

### Task 10: End-to-End Validation (~30 min) ✅
- **Commit:** `a907bd2`

## Completion

- **Date:** 2026-02-21
- **Estimated Duration:** M (~2-3 days)
- **Actual Duration:** ~2 hours (first commit 23:08, last feat commit 23:26, closing commit 23:40 — same session; planning/spec session started at 21:40)
- **Variance:** Estimated M (~2-3 days), actual ~2h wall-clock — ~12-18x faster with AI assistance
- **Files modified:** 31 files (+1,582 / -24 lines)
- **Tests added:** 36 (7 test suites)

## Deviations & Decisions

- **Added:**
  - `MobileNav.tsx` (CC) — hamburger menu for responsive nav (Task 4)
  - `CategoryCard.tsx` — reusable category card component (Task 6)
  - `HomepageHero.tsx` — hero section extracted as component (Task 9)
  - `CategoryNotFound.tsx` — reusable 404 component (Task 8)
- **Changed:**
  - `ProductCard` renders double "Agotado" badge (overlay + text) for max visibility (Task 5)
  - Supabase queries refactored to use typed helper functions with explicit assertions (Task 7/10)
  - Root `page.tsx` removed; homepage moved to `(storefront)/page.tsx` route group (Task 9)
- **Skipped:** None
- **Key Decisions:**
  - Vitest setup requires explicit `cleanup()` in `afterEach` for React 19 + testing-library v16
  - Supabase `.eq()` chains resolve to `never` in TS — established pattern of typed data-fetching helpers
- **Escalated ADRs:** ADR-005 (Typed Data-Fetching Helpers for Supabase)
- **Lesson:** Supabase's generated types don't handle chained `.eq()` well with strict TypeScript. Always wrap queries in typed helper functions from the start.
